{% extends "account/base.html" %}

{% block head_title %}ì¸ì¦ ì´ë©”ì¼ ì „ì†¡{% endblock %}

{% block badge_text %}VERIFICATION SENT{% endblock %}

{% block page_title %}ì¸ì¦ ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”{% endblock %}

{% block page_description %}ì´ë©”ì¼ ì£¼ì†Œ ì¸ì¦ì„ ìœ„í•´ ë§í¬ë¥¼ ë³´ë‚´ë“œë ¸ìŠµë‹ˆë‹¤{% endblock %}

{% block content %}
<div class="text-center space-y-6">
    <div class="w-20 h-20 bg-accent/20 rounded-full flex items-center justify-center mx-auto">
        <svg class="w-10 h-10 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
        </svg>
    </div>

    <div class="bg-gray-dark/30 rounded-xl p-6 border border-gray-700">
        <h3 class="text-lg font-semibold text-white mb-3">ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”</h3>
        <p class="text-gray-300 text-sm leading-relaxed">
            ê³„ì • ì¸ì¦ì„ ìœ„í•´ ì´ë©”ì¼ë¡œ ì¸ì¦ ë§í¬ë¥¼ ë³´ë‚´ë“œë ¸ìŠµë‹ˆë‹¤.<br>
            ë°›ì€ í¸ì§€í•¨ì„ í™•ì¸í•˜ê³  ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ê³„ì •ì„ í™œì„±í™”í•´ì£¼ì„¸ìš”.
        </p>
    </div>

    <div class="bg-gray-dark/20 rounded-xl p-4 border border-gray-700">
        <div class="flex items-start space-x-3">
            <svg class="w-5 h-5 text-accent mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="text-left">
                <p class="text-xs text-gray-400 font-medium mb-1">ğŸ’¡ íŒ</p>
                <p class="text-xs text-gray-400">
                    ì´ë©”ì¼ì´ ì˜¤ì§€ ì•Šì•˜ë‹¤ë©´ ìŠ¤íŒ¸ í´ë”ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.<br>
                    ëª‡ ë¶„ í›„ì—ë„ ì´ë©”ì¼ì´ ì˜¤ì§€ ì•Šìœ¼ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ìš”ì²­í•´ì£¼ì„¸ìš”.
                </p>
            </div>
        </div>
    </div>

    <!-- ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
    {% if messages %}
    <div class="space-y-2">
        {% for message in messages %}
        <div class="rounded-xl p-4 border {% if message.tags == 'success' %}bg-green-500/10 border-green-500/50 text-green-300{% elif message.tags == 'error' %}bg-red-500/10 border-red-500/50 text-red-300{% else %}bg-blue-500/10 border-blue-500/50 text-blue-300{% endif %}">
            <div class="flex items-center space-x-2">
                {% if message.tags == 'success' %}
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                {% elif message.tags == 'error' %}
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                </svg>
                {% else %}
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
                {% endif %}
                <p class="text-sm font-medium">{{ message }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ì¸ì¦ ì´ë©”ì¼ ì¬ë°œì†¡ í¼ -->
    <form method="POST" action="{% url 'accounts:resend_verification' %}" id="resendForm" class="space-y-4">
        {% csrf_token %}
        
        <!-- ì´ë©”ì¼ ì…ë ¥ í•„ë“œ (ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš°) -->
        <div id="emailInputDiv">
            <label for="email" class="block text-sm font-medium text-gray-300 mb-2">
                ì´ë©”ì¼ ì£¼ì†Œ <span class="text-red-400">*</span>
            </label>
            <input 
                type="email" 
                name="email"
                id="emailInput"
                class="w-full bg-gray-dark/50 border border-gray-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:border-accent focus:ring-2 focus:ring-accent/20 focus:outline-none transition-all duration-200"
                placeholder="ê°€ì…í•˜ì‹  ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"
                {% if user.is_authenticated %}value="{{ user.email }}" readonly{% endif %}
            >
            <p class="mt-1 text-xs text-gray-400">ê°€ì… ì‹œ ì‚¬ìš©í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
        </div>
        
        <button 
            type="submit"
            id="resendBtn"
            class="w-full bg-orange-500/20 border border-orange-500/50 text-orange-300 py-3 rounded-xl font-medium hover:bg-orange-500/30 transition-all duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed"
        >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span id="btnText">ì¸ì¦ ì´ë©”ì¼ ë‹¤ì‹œ ë³´ë‚´ê¸°</span>
        </button>
    </form>

    <div class="flex space-x-4">
        <a 
            href="{% url 'account_login' %}" 
            class="flex-1 bg-gray-medium/50 border border-gray-600 text-white py-3 rounded-xl font-medium hover:bg-gray-medium transition-all duration-200 text-center"
        >
            ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
        </a>
        <a 
            href="{% url 'home' %}" 
            class="flex-1 bg-gradient-to-r from-accent to-accent-dark text-dark py-3 rounded-xl font-semibold hover:shadow-lg hover:shadow-accent/25 transition-all duration-300 text-center"
        >
            í™ˆìœ¼ë¡œ
        </a>
    </div>

    <script>
        // ì¬ë°œì†¡ ë²„íŠ¼ ì¿¨ë‹¤ìš´ (3ë¶„)
        const resendBtn = document.getElementById('resendBtn');
        const btnText = document.getElementById('btnText');
        const COOLDOWN_TIME = 180; // 3ë¶„ (ì´ˆ)
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë§ˆì§€ë§‰ ë°œì†¡ ì‹œê°„ í™•ì¸
        const lastSent = localStorage.getItem('lastEmailSent');
        if (lastSent) {
            const elapsed = Math.floor((Date.now() - parseInt(lastSent)) / 1000);
            if (elapsed < COOLDOWN_TIME) {
                startCooldown(COOLDOWN_TIME - elapsed);
            }
        }
        
        document.getElementById('resendForm').addEventListener('submit', function(e) {
            if (resendBtn.disabled) {
                e.preventDefault();
                return;
            }
            
            // ì´ë©”ì¼ ì…ë ¥ í™•ì¸ (ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš°)
            const emailInput = document.getElementById('emailInput');
            if (emailInput && !emailInput.readOnly && !emailInput.value.trim()) {
                e.preventDefault();
                alert('ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                emailInput.focus();
                return;
            }
            
            // ë°œì†¡ ì‹œê°„ ê¸°ë¡
            localStorage.setItem('lastEmailSent', Date.now().toString());
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ì¿¨ë‹¤ìš´ ì‹œì‘
            startCooldown(COOLDOWN_TIME);
        });
        
        function startCooldown(seconds) {
            resendBtn.disabled = true;
            let remaining = seconds;
            
            const interval = setInterval(() => {
                const minutes = Math.floor(remaining / 60);
                const secs = remaining % 60;
                btnText.textContent = `ë‹¤ì‹œ ë³´ë‚´ê¸° (${minutes}:${secs.toString().padStart(2, '0')})`;
                
                remaining--;
                
                if (remaining < 0) {
                    clearInterval(interval);
                    resendBtn.disabled = false;
                    btnText.textContent = 'ì¸ì¦ ì´ë©”ì¼ ë‹¤ì‹œ ë³´ë‚´ê¸°';
                }
            }, 1000);
        }
    </script>
</div>
{% endblock %}

{% block footer_links %}
<p class="text-gray-400">
    ë¬¸ì œê°€ ê³„ì†ë˜ë©´ 
    <a href="#" class="text-accent hover:text-accent-dark transition-colors duration-200">
        ê³ ê°ì§€ì›
    </a>ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.
</p>
{% endblock %}
