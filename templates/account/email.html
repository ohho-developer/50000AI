{% extends "account/base.html" %}
{% load account %}

{% block head_title %}이메일 관리{% endblock %}

{% block badge_text %}EMAIL MANAGEMENT{% endblock %}

{% block page_title %}이메일 관리{% endblock %}

{% block page_description %}계정에 연결된 이메일을 관리하세요{% endblock %}

{% block content %}
<div class="space-y-6">
    {% if user.emailaddress_set.all %}
        <div>
            <h3 class="text-lg font-semibold text-white mb-4">등록된 이메일 주소</h3>
            <div class="space-y-3">
                {% for emailaddress in user.emailaddress_set.all %}
                    <div class="bg-gray-dark/30 rounded-xl p-4 border border-gray-600 flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 rounded-full {% if emailaddress.verified %}bg-accent{% else %}bg-gray-500{% endif %}"></div>
                            <span class="text-white">{{ emailaddress.email }}</span>
                            {% if emailaddress.primary %}
                                <span class="bg-accent/20 text-accent text-xs px-2 py-1 rounded-full">주 이메일</span>
                            {% endif %}
                            {% if emailaddress.verified %}
                                <span class="bg-green-500/20 text-green-400 text-xs px-2 py-1 rounded-full">인증됨</span>
                            {% else %}
                                <span class="bg-yellow-500/20 text-yellow-400 text-xs px-2 py-1 rounded-full">미인증</span>
                            {% endif %}
                        </div>
                        <div class="flex space-x-2">
                            {% if not emailaddress.verified %}
                                <form method="POST" action="{% url 'account_email' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="email" value="{{ emailaddress.email }}">
                                    <button type="submit" name="action_send" class="text-accent hover:text-accent-dark text-sm transition-colors duration-200">
                                        재전송
                                    </button>
                                </form>
                            {% endif %}
                            {% if user.emailaddress_set.count > 1 %}
                                <form method="POST" action="{% url 'account_email' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="email" value="{{ emailaddress.email }}">
                                    <button type="submit" name="action_remove" class="text-red-400 hover:text-red-300 text-sm transition-colors duration-200">
                                        삭제
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Add Email Form -->
    <div class="border-t border-gray-600 pt-6">
        <h3 class="text-lg font-semibold text-white mb-4">이메일 추가</h3>
        <form method="POST" action="{% url 'account_email' %}" class="space-y-4">
            {% csrf_token %}
            <div>
                <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-300 mb-2">
                    새 이메일 주소
                </label>
                <input 
                    type="email" 
                    name="{{ form.email.name }}"
                    id="{{ form.email.id_for_label }}"
                    class="w-full bg-gray-dark/50 border border-gray-600 rounded-xl px-4 py-3 text-white placeholder-gray-400 focus:border-accent focus:ring-2 focus:ring-accent/20 focus:outline-none transition-all duration-200"
                    placeholder="new@email.com"
                    required
                >
                {% if form.email.errors %}
                    <p class="mt-2 text-sm text-red-400">{{ form.email.errors.0 }}</p>
                {% endif %}
            </div>
            <button 
                type="submit" 
                name="action_add"
                class="w-full bg-gradient-to-r from-accent to-accent-dark text-dark py-3 rounded-xl font-semibold hover:shadow-lg hover:shadow-accent/25 transition-all duration-300"
            >
                이메일 추가
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block footer_links %}
<div class="flex space-x-6">
    <a href="{% url 'accounts:profile' %}" class="text-accent hover:text-accent-dark transition-colors duration-200">
        프로필로 돌아가기
    </a>
    <a href="{% url 'nutrients_codi:dashboard' %}" class="text-accent hover:text-accent-dark transition-colors duration-200">
        뉴트리언트코디
    </a>
</div>
{% endblock %}
